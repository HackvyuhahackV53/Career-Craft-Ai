<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Resume Builder | CareerCraft AI</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- html2pdf.js for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #6e8efb;
            --secondary-color: #a777e3;
            --dark-color: #2c3e50;
            --light-color: #f8f9fa;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fa;
        }
        
        .resume-container {
            min-height: 100vh;
            background-color: #f5f7fa;
        }
        
        .form-section {
            background-color: white;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            border-right: 1px solid #e9ecef;
        }
        
        .preview-section {
            background-color: #f8fafc;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .resume-paper {
            background-color: white;
            width: 210mm;
            min-height: 297mm;
            padding: 2.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .resume-paper:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .ai-suggestion {
            background-color: #f0f7ff;
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 8px 8px 0;
            transition: all 0.3s ease;
        }
        
        .ai-suggestion:hover {
            background-color: #e1f0ff;
        }
        
        .ai-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(110, 142, 251, 0.3);
        }
        
        .ai-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(110, 142, 251, 0.4);
        }
        
        .section-divider {
            border-top: 2px solid var(--primary-color);
            margin: 1.8rem 0;
            opacity: 0.7;
        }
        
        .badge-skill {
            background-color: var(--primary-color);
            color: white;
            padding: 0.5rem 0.8rem;
            border-radius: 20px;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            display: inline-block;
            font-weight: 500;
        }
        
        .nav-brand {
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .form-control, .form-select {
            border-radius: 6px;
            padding: 0.6rem 0.75rem;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(110, 142, 251, 0.25);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-info {
            background-color: var(--info-color);
            border-color: var(--info-color);
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border-color: #333;
            transform: scale(1.1);
        }
        
        @media (max-width: 992px) {
            .form-section, .preview-section {
                height: auto;
                min-height: 50vh;
            }
            
            .resume-paper {
                width: 100%;
                margin-top: 2rem;
            }
        }
        
        /* Animation for live preview */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .preview-item {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* Loading spinner for PDF generation */
        .spinner {
            display: none;
            width: 40px;
            height: 40px;
            margin: 0 auto;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand nav-brand" href="/home">CareerCraft AI</a>
            <div class="d-flex">
                <a th:href="@{/profile}" class="btn btn-outline-light me-2">
                    <i class="fas fa-user-circle me-1"></i> Profile
                </a>
                <a th:href="@{/logout}" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt me-1"></i> Logout
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="resume-container">
        <div class="row g-0">
            <!-- Left Side - Form -->
            <div class="col-lg-6">
                <div class="form-section">
                    <h2 class="mb-4"><i class="fas fa-pencil-alt me-2"></i>Resume Builder</h2>
                    
                    <div th:if="${success}" class="alert alert-success alert-dismissible fade show">
                        <span th:text="${success}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    
                    <form th:action="@{/resume-builder/save}" th:object="${resume}" method="post">
                        <!-- Template Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Choose a Template</label>
                            <select class="form-select" th:field="*{template}">
                                <option th:each="template : ${templates}" 
                                        th:value="${template}" 
                                        th:text="${template}"
                                        th:selected="${template == resume.template}"></option>
                            </select>
                        </div>
                        
                        <!-- Color Palette Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Choose Color Palette</label>
                            <div class="d-flex align-items-center mt-2">
                                <div class="color-option selected" data-primary="#6e8efb" data-secondary="#a777e3" style="background: linear-gradient(135deg, #6e8efb, #a777e3);" onclick="changeColorPalette(this)"></div>
                                <div class="color-option" data-primary="#4CAF50" data-secondary="#8BC34A" style="background: linear-gradient(135deg, #4CAF50, #8BC34A);" onclick="changeColorPalette(this)"></div>
                                <div class="color-option" data-primary="#FF5722" data-secondary="#FF9800" style="background: linear-gradient(135deg, #FF5722, #FF9800);" onclick="changeColorPalette(this)"></div>
                                <div class="color-option" data-primary="#9C27B0" data-secondary="#E91E63" style="background: linear-gradient(135deg, #9C27B0, #E91E63);" onclick="changeColorPalette(this)"></div>
                                <div class="color-option" data-primary="#607D8B" data-secondary="#795548" style="background: linear-gradient(135deg, #607D8B, #795548);" onclick="changeColorPalette(this)"></div>
                            </div>
                        </div>
                        
                        <!-- Personal Information -->
                        <h4 class="mb-3 fw-semibold text-primary"><i class="fas fa-user me-2"></i>Personal Information</h4>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" th:field="*{fullName}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" th:field="*{email}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" th:field="*{phone}">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Address</label>
                                <input type="text" class="form-control" th:field="*{address}">
                            </div>
                        </div>
                        
                        <!-- Professional Summary -->
                        <h4 class="mb-3 fw-semibold text-primary"><i class="fas fa-file-alt me-2"></i>Professional Summary</h4>
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <label class="form-label">Write a compelling summary</label>
                                <button type="button" class="ai-button" onclick="showAISummaryModal()">
                                    <i class="fas fa-robot me-1"></i> AI Generate
                                </button>
                            </div>
                            <textarea class="form-control" rows="4" th:field="*{summary}" placeholder="Describe your professional background and skills"></textarea>
                            
                            <!-- AI Suggestions -->
                            <div id="ai-suggestions-container" class="mt-2"></div>
                        </div>
                        
                        <!-- Work Experience -->
                        <h4 class="mb-3 fw-semibold text-primary"><i class="fas fa-briefcase me-2"></i>Work Experience</h4>
                        <div class="mb-4" th:each="exp, iterStat : *{experiences}">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Job Title</label>
                                    <input type="text" class="form-control" th:field="*{experiences[__${iterStat.index}__].jobTitle}" placeholder="e.g. Software Engineer">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Company</label>
                                    <input type="text" class="form-control" th:field="*{experiences[__${iterStat.index}__].company}" placeholder="e.g. Google">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Duration</label>
                                    <input type="text" class="form-control" th:field="*{experiences[__${iterStat.index}__].duration}" placeholder="e.g. 2018 - Present">
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label">Description</label>
                                    <textarea class="form-control" rows="3" th:field="*{experiences[__${iterStat.index}__].description}" placeholder="Describe your responsibilities and achievements"></textarea>
                                </div>
                            </div>
                            <hr th:if="${!iterStat.last}" class="my-4">
                        </div>
                        <button type="button" class="btn btn-outline-primary mb-4" onclick="addExperience()">
                            <i class="fas fa-plus me-1"></i> Add Experience
                        </button>
                        
                        <!-- Education -->
                        <h4 class="mb-3 fw-semibold text-primary"><i class="fas fa-graduation-cap me-2"></i>Education</h4>
                        <div class="mb-4" th:each="edu, iterStat : *{educations}">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Degree</label>
                                    <input type="text" class="form-control" th:field="*{educations[__${iterStat.index}__].degree}" placeholder="e.g. Bachelor of Science">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Institution</label>
                                    <input type="text" class="form-control" th:field="*{educations[__${iterStat.index}__].institution}" placeholder="e.g. University of California">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Year</label>
                                    <input type="text" class="form-control" th:field="*{educations[__${iterStat.index}__].year}" placeholder="e.g. 2015 - 2019">
                                </div>
                            </div>
                            <hr th:if="${!iterStat.last}" class="my-4">
                        </div>
                        <button type="button" class="btn btn-outline-primary mb-4" onclick="addEducation()">
                            <i class="fas fa-plus me-1"></i> Add Education
                        </button>
                        
                        <!-- Skills -->
                        <h4 class="mb-3 fw-semibold text-primary"><i class="fas fa-code me-2"></i>Skills</h4>
                        <div class="mb-4">
                            <label class="form-label">Add your skills (comma separated)</label>
                            <input type="text" class="form-control" th:field="*{skills}" placeholder="e.g. Java, Python, Project Management">
                        </div>
                        
                        <!-- Certifications -->
                        <h4 class="mb-3 fw-semibold text-primary"><i class="fas fa-certificate me-2"></i>Certifications</h4>
                        <div class="mb-4">
                            <label class="form-label">Add certifications (one per line)</label>
                            <textarea class="form-control" rows="3" th:field="*{certifications}" placeholder="e.g. AWS Certified Developer, Google Cloud Professional"></textarea>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="d-flex justify-content-between mt-5 pt-3 border-top">
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="fas fa-save me-1"></i> Save Resume
                            </button>
                            <div>
                                <button type="button" class="btn btn-success px-4 me-2" onclick="downloadPDF()">
                                    <i class="fas fa-file-pdf me-1"></i> Download PDF
                                </button>
                                <button type="button" class="btn btn-info px-4" data-bs-toggle="modal" data-bs-target="#shareModal">
                                    <i class="fas fa-share-alt me-1"></i> Share
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Right Side - Preview -->
            <div class="col-lg-6">
                <div class="preview-section">
                    <div class="resume-paper" id="resumePreview">
                        <!-- Preview will be dynamically updated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Summary Modal -->
    <div class="modal fade" id="aiSummaryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-robot me-2"></i>AI Summary Generator</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-4">Let AI help you create a professional summary based on your skills and experience.</p>
                    <div class="mb-3">
                        <label class="form-label">Your Key Skills</label>
                        <input type="text" class="form-control" id="aiSkillsInput" placeholder="e.g. Java, Project Management, Team Leadership">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Years of Experience</label>
                        <input type="text" class="form-control" id="aiExperienceInput" placeholder="e.g. 5">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="generateAISummary()">
                        <i class="fas fa-magic me-1"></i> Generate Summary
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal fade" id="shareModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title"><i class="fas fa-share-alt me-2"></i>Share Your Resume</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Shareable Link</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="shareableLink" value="https://careercraft.ai/resume/your-unique-id" readonly>
                            <button class="btn btn-outline-secondary" type="button" onclick="copyShareLink()">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                        <small class="text-muted">Anyone with this link can view your resume</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Share via</label>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-primary flex-grow-1" onclick="shareOnLinkedIn()">
                                <i class="fab fa-linkedin me-1"></i> LinkedIn
                            </button>
                            <button class="btn btn-outline-info flex-grow-1" onclick="shareOnTwitter()">
                                <i class="fab fa-twitter me-1"></i> Twitter
                            </button>
                            <button class="btn btn-outline-success flex-grow-1" onclick="shareOnWhatsApp()">
                                <i class="fab fa-whatsapp me-1"></i> WhatsApp
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Download Options</label>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-danger flex-grow-1" onclick="downloadPDF()">
                                <i class="fas fa-file-pdf me-1"></i> PDF
                            </button>
                            <button class="btn btn-outline-secondary flex-grow-1" onclick="downloadDOC()">
                                <i class="fas fa-file-word me-1"></i> Word
                            </button>
                            <button class="btn btn-outline-dark flex-grow-1" onclick="downloadTXT()">
                                <i class="fas fa-file-alt me-1"></i> Text
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Loading Modal -->
    <div class="modal fade" id="pdfLoadingModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-4">
                    <div class="spinner"></div>
                    <h5 class="mt-3">Generating PDF...</h5>
                    <p class="text-muted">This may take a few moments</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Custom JS -->
    <script>
        // Current color palette
        let currentPrimaryColor = '#6e8efb';
        let currentSecondaryColor = '#a777e3';
        
        // Show AI Summary Modal
        function showAISummaryModal() {
            const modal = new bootstrap.Modal(document.getElementById('aiSummaryModal'));
            modal.show();
        }
        
        // Generate AI Summary
        function generateAISummary() {
            const skills = $('#aiSkillsInput').val();
            const experience = $('#aiExperienceInput').val();
            
            if (!skills || !experience) {
                alert('Please enter both skills and experience');
                return;
            }
            
            $.ajax({
                url: '/resume-builder/generate-summary',
                type: 'POST',
                data: {
                    skills: skills,
                    experience: experience
                },
                success: function(response) {
                    $('#aiSummaryModal').modal('hide');
                    $('#ai-suggestions-container').html(`
                        <div class="ai-suggestion">
                            <h6><i class="fas fa-lightbulb me-2"></i>AI Suggestion</h6>
                            <p>${response}</p>
                            <button class="btn btn-sm btn-outline-primary" onclick="useAISuggestion(this)">
                                <i class="fas fa-check me-1"></i>Use This
                            </button>
                        </div>
                    `);
                },
                error: function() {
                    alert('Error generating summary. Please try again.');
                }
            });
        }
        
        // Use AI suggestion
        function useAISuggestion(button) {
            const suggestion = $(button).siblings('p').text();
            $('textarea[name="summary"]').val(suggestion);
            updatePreview();
        }
        
        // Add new experience field
        function addExperience() {
            const index = $('[name^="experiences"]').length / 4; // Count existing fields
            const newField = `
                <div class="mb-4">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Job Title</label>
                            <input type="text" class="form-control" name="experiences[${index}].jobTitle">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" name="experiences[${index}].company">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Duration</label>
                            <input type="text" class="form-control" name="experiences[${index}].duration" placeholder="e.g. 2018 - Present">
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" rows="3" name="experiences[${index}].description"></textarea>
                        </div>
                    </div>
                    <hr>
                </div>
            `;
            $('[onclick="addExperience()"]').before(newField);
        }
        
        // Add new education field
        function addEducation() {
            const index = $('[name^="educations"]').length / 3; // Count existing fields
            const newField = `
                <div class="mb-4">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Degree</label>
                            <input type="text" class="form-control" name="educations[${index}].degree">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Institution</label>
                            <input type="text" class="form-control" name="educations[${index}].institution">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Year</label>
                            <input type="text" class="form-control" name="educations[${index}].year">
                        </div>
                    </div>
                    <hr>
                </div>
            `;
            $('[onclick="addEducation()"]').before(newField);
        }
        
        // Change color palette
        function changeColorPalette(element) {
            // Remove selected class from all options
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            
            // Get new colors
            currentPrimaryColor = element.dataset.primary;
            currentSecondaryColor = element.dataset.secondary;
            
            // Update CSS variables
            document.documentElement.style.setProperty('--primary-color', currentPrimaryColor);
            document.documentElement.style.setProperty('--secondary-color', currentSecondaryColor);
            
            // Update preview to reflect new colors
            updatePreview();
        }
        
        // Copy share link
        function copyShareLink() {
            const linkInput = document.getElementById('shareableLink');
            linkInput.select();
            document.execCommand('copy');
            
            // Show feedback
            const originalText = linkInput.value;
            linkInput.value = 'Copied to clipboard!';
            setTimeout(() => {
                linkInput.value = originalText;
            }, 2000);
        }
        
        // Share on LinkedIn
        function shareOnLinkedIn() {
            const url = encodeURIComponent(document.getElementById('shareableLink').value);
            const title = encodeURIComponent('Check out my resume created with CareerCraft AI');
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
        }
        
        // Share on Twitter
        function shareOnTwitter() {
            const url = encodeURIComponent(document.getElementById('shareableLink').value);
            const text = encodeURIComponent('Check out my professional resume created with @CareerCraftAI');
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }
        
        // Share on WhatsApp
        function shareOnWhatsApp() {
            const url = encodeURIComponent(document.getElementById('shareableLink').value);
            const text = encodeURIComponent('Check out my resume created with CareerCraft AI');
            window.open(`https://wa.me/?text=${text}%20${url}`, '_blank');
        }
        
        // Download PDF
        function downloadPDF() {
            const loadingModal = new bootstrap.Modal(document.getElementById('pdfLoadingModal'));
            loadingModal.show();
            
            // Show spinner
            document.querySelector('#pdfLoadingModal .spinner').style.display = 'block';
            
            // Clone the resume preview to avoid modifying the original
            const element = document.getElementById('resumePreview');
            const clone = element.cloneNode(true);
            
            // Add print-specific styles
            const printStyles = document.createElement('style');
            printStyles.innerHTML = `
                @media print {
                    body * {
                        visibility: hidden;
                    }
                    #resume-print, #resume-print * {
                        visibility: visible;
                    }
                    #resume-print {
                        position: absolute;
                        left: 0;
                        top: 0;
                        width: 100%;
                        padding: 0;
                        margin: 0;
                        box-shadow: none;
                    }
                }
            `;
            clone.appendChild(printStyles);
            clone.id = 'resume-print';
            
            // Create a temporary container for printing
            const printContainer = document.createElement('div');
            printContainer.style.position = 'absolute';
            printContainer.style.left = '-9999px';
            printContainer.appendChild(clone);
            document.body.appendChild(printContainer);
            
            // Generate PDF
            const opt = {
                margin: 10,
                filename: 'my_resume.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, logging: true, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(printContainer).save().then(() => {
                loadingModal.hide();
                document.body.removeChild(printContainer);
            });
        }
        
        // Download Word (placeholder)
        function downloadDOC() {
            alert('Word document download will be implemented in the future');
        }
        
        // Download Text (placeholder)
        function downloadTXT() {
            alert('Text file download will be implemented in the future');
        }
        
        // Update preview in real-time
        function updatePreview() {
            const formData = $('form').serializeArray();
            const data = {};
            
            // Convert form data to object
            formData.forEach(item => {
                // Handle nested objects (experiences, educations)
                if (item.name.includes('[')) {
                    const parts = item.name.split(/\[|\]\./).filter(p => p);
                    let current = data;
                    
                    for (let i = 0; i < parts.length - 1; i++) {
                        const part = parts[i];
                        if (!current[part]) {
                            // Handle array indices
                            if (!isNaN(parts[i+1])) {
                                current[part] = [];
                            } else {
                                current[part] = {};
                            }
                        }
                        current = current[part];
                    }
                    
                    current[parts[parts.length - 1]] = item.value;
                } else {
                    data[item.name] = item.value;
                }
            });
            
            // Generate HTML for preview
            let previewHtml = `
                <div class="text-center mb-4" ${data.fullName ? '' : 'style="display:none"'}>
                    <h1 style="color: ${currentPrimaryColor};">${data.fullName || ''}</h1>
                    <div ${(data.email || data.phone || data.address) ? '' : 'style="display:none"'}>
                        ${data.email ? `<p>${data.email}</p>` : ''}
                        ${data.phone ? `<p>${data.phone}</p>` : ''}
                        ${data.address ? `<p>${data.address}</p>` : ''}
                    </div>
                </div>
            `;
            
            // Summary section
            if (data.summary) {
                previewHtml += `
                    <div class="preview-item">
                        <h3 class="section-divider" style="border-color: ${currentPrimaryColor}">Summary</h3>
                        <p>${data.summary}</p>
                    </div>
                `;
            }
            
            // Experience section
            if (data.experiences && data.experiences.length > 0 && data.experiences[0].jobTitle) {
                previewHtml += `<div class="preview-item"><h3 class="section-divider" style="border-color: ${currentPrimaryColor}">Experience</h3>`;
                
                data.experiences.forEach((exp, index) => {
                    if (exp.jobTitle) {
                        previewHtml += `
                            <div class="mb-3">
                                <h4>${exp.jobTitle} at ${exp.company || ''}</h4>
                                ${exp.duration ? `<p class="text-muted">${exp.duration}</p>` : ''}
                                ${exp.description ? `<p>${exp.description}</p>` : ''}
                                ${index < data.experiences.length - 1 ? '<hr>' : ''}
                            </div>
                        `;
                    }
                });
                
                previewHtml += '</div>';
            }
            
            // Education section
            if (data.educations && data.educations.length > 0 && data.educations[0].degree) {
                previewHtml += `<div class="preview-item"><h3 class="section-divider" style="border-color: ${currentPrimaryColor}">Education</h3>`;
                
                data.educations.forEach((edu, index) => {
                    if (edu.degree) {
                        previewHtml += `
                            <div class="mb-3">
                                <h4>${edu.degree}</h4>
                                ${edu.institution ? `<p>${edu.institution}</p>` : ''}
                                ${edu.year ? `<p class="text-muted">${edu.year}</p>` : ''}
                                ${index < data.educations.length - 1 ? '<hr>' : ''}
                            </div>
                        `;
                    }
                });
                
                previewHtml += '</div>';
            }
            
            // Skills section
            if (data.skills) {
                const skills = data.skills.split(',').filter(skill => skill.trim());
                if (skills.length > 0) {
                    previewHtml += `
                        <div class="preview-item">
                            <h3 class="section-divider" style="border-color: ${currentPrimaryColor}">Skills</h3>
                            <div>
                                ${skills.map(skill => `<span class="badge-skill" style="background-color: ${currentPrimaryColor}">${skill.trim()}</span>`).join('')}
                            </div>
                        </div>
                    `;
                }
            }
            
            // Certifications section
            if (data.certifications) {
                const certs = data.certifications.split('\n').filter(cert => cert.trim());
                if (certs.length > 0) {
                    previewHtml += `
                        <div class="preview-item">
                            <h3 class="section-divider" style="border-color: ${currentPrimaryColor}">Certifications</h3>
                            <ul>
                                ${certs.map(cert => `<li>${cert.trim()}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            }
            
            // Update preview container
            $('#resumePreview').html(previewHtml);
        }
        
        // Initialize preview on page load
        $(document).ready(function() {
            updatePreview();
            
            // Update preview on any input change
            $(document).on('input', 'input, textarea, select', function() {
                updatePreview();
            });
        });
    </script>
</body>
</html>